package ssa_test

import (
	"testing"

	"bitbucket.org/openbankingteam/conformance-dcr/pkg/ssa"
)

const PubKeyTest = `-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzSkSfBX6BqUU2xOLKH6M
E5R3ZEPi7Ab7fXCRGUibKVpzVfC/+ldIuFkmbmpnrtCgEGMmeZK2DdcHt/PTk+6R
R5Jn7Huhxtn4tjLqe4Rle53QGIfdIwQyZAgKvNa9rjrQ5no2Ux2ViSu0csS0FaHg
2RK06JGBBwk1HZShDRxQpwuoW7fwPmhybpzZGypM4LsHGIzKrW2ygYI/1u5zDeFJ
Lj8qr7Qvkny4z/X3Na+mkgsQ8z/smDyBG6ZRRpMzFriFN+F+scq6nUGDYSuQ4RSm
R95fGAKyibC6uuAN3bcWbIEtuLTTPr9mPMJv0YZLPQ/ItC8gyMdK9MMSqRzbtP/V
4QIDAQAB
-----END PUBLIC KEY-----`

const PrivKeyTest = ``

func TestValidateSSA(t *testing.T) {
	ssaJwt := `eyJ0eXAiOiJKV1QiLCJhbGciOiJQUzI1NiIsImtpZCI6IjEyMzQ1Njc4OSJ9.eyJpc3MiOiJPcGVuQmFua2luZyBMdGQiLCJpYXQiOjE0OTI3NTYzMzEsImV4cCI6MTU5NTc1NzU1MCwianRpIjoiaWQxMjM0NTY4NTQzOTQ4NzY3OCIsInNvZnR3YXJlX2Vudmlyb25tZW50IjoicHJvZHVjdGlvbiIsInNvZnR3YXJlX21vZGUiOiJsaXZlIiwic29mdHdhcmVfaWQiOiI2NWQxZjI3Yy00YWVhLTQ1NDktOWMyMS02MGU0OTVhN2E4NmYiLCJzb2Z0d2FyZV9jbGllbnRfaWQiOiJPcGVuQmFua2luZyBUUFAgQ2xpZW50IFVuaXF1ZSBJRCIsInNvZnR3YXJlX2NsaWVudF9uYW1lIjoiQW1hem9uIFByaW1lIE1vdmllcyIsInNvZnR3YXJlX2NsaWVudF9kZXNjcmlwdGlvbiI6IkFtYXpvbiBQcmltZSBNb3ZpZXMgaXMgYSBtb3Zpbmcgc3RyZWFtaW5nIHNlcnZpY2UiLCJzb2Z0d2FyZV92ZXJzaW9uIjoiMi4yIiwic29mdHdhcmVfY2xpZW50X3VyaSI6Imh0dHBzOi8vcHJpbWUuYW1hem9uLmNvbSIsInNvZnR3YXJlX3JlZGlyZWN0X3VyaXMiOlsiaHR0cHM6Ly9wcmltZS5hbWF6b24uY29tL2NiIiwiaHR0cHM6Ly9wcmltZS5hbWF6b24uY28udWsvY2IiXSwic29mdHdhcmVfcm9sZXMiOlsiUElTUCIsIkFJU1AiXSwib3JnYW5pc2F0aW9uX2NvbXBldGVudF9hdXRob3JpdHlfY2xhaW1zIjp7ImF1dGhvcml0eV9pZCI6IkZNQSIsInJlZ2lzdHJhdGlvbl9pZCI6IjExMTExMSIsInN0YXR1cyI6IkFjdGl2ZSIsImF1dGhvcmlzYXRpb25zIjpbeyJtZW1iZXJfc3RhdGUiOiJHQiIsInJvbGVzIjpbIlBJU1AiLCJBSVNQIl19LHsibWVtYmVyX3N0YXRlIjoiSVIiLCJyb2xlcyI6WyJQSVNQIl19XX0sInNvZnR3YXJlX2xvZ29fdXJpIjoiaHR0cHM6Ly9wcmltZS5hbWF6b24uY29tL2xvZ28ucG5nIiwib3JnX3N0YXR1cyI6IkFjdGl2ZSIsIm9yZ19pZCI6IkFtYXpvbiBUUFBJRCIsIm9yZ19uYW1lIjoiT3BlbkJhbmtpbmcgVFBQIFJlZ2lzdGVyZWQgTmFtZSIsIm9yZ19jb250YWN0cyI6W3sibmFtZSI6ImNvbnRhY3QgbmFtZSIsImVtYWlsIjoiY29udGFjdEBjb250YWN0LmNvbSIsInBob25lIjoiKzQ0Nzg5MDEzMDU1OCIsInR5cGUiOiJidXNpbmVzcyJ9LHsibmFtZSI6ImNvbnRhY3QgbmFtZSIsImVtYWlsIjoiY29udGFjdEBjb250YWN0LmNvbSIsInBob25lIjoiKzQ0Nzg5MDEzMDU1OCIsInR5cGUiOiJ0ZWNobmljYWwifV0sIm9yZ19qd2tzX2VuZHBvaW50IjoiaHR0cHM6Ly9qd2tzLm9wZW5iYW5raW5nLm9yZy51ay9vcmdfaWQvb3JnX2lkLmprd3MiLCJvcmdfandrc19yZXZva2VkX2VuZHBvaW50IjoiaHR0cHM6Ly9qd2tzLm9wZW5iYW5raW5nLm9yZy51ay9vcmdfaWQvcmV2b2tlZC9vcmdfaWQuamt3cyIsInNvZnR3YXJlX2p3a3NfZW5kcG9pbnQiOiJodHRwczovL2p3a3Mub3BlbmJhbmtpbmcub3JnLnVrL29yZ19pZC9zb2Z0d2FyZV9pZC5qa3dzIiwic29mdHdhcmVfandrc19yZXZva2VkX2VuZHBvaW50IjoiaHR0cHM6Ly9qd2tzLm9wZW5iYW5raW5nLm9yZy51ay9vcmdfaWQvcmV2b2tlZC9zb2Z0d2FyZV9pZC5qa3dzIiwic29mdHdhcmVfcG9saWN5X3VyaSI6Imh0dHBzOi8vdHBwLmNvbS9wb2xpY3kuaHRtbCIsInNvZnR3YXJlX3Rvc191cmkiOiJodHRwczovL3RwcC5jb20vdG9zLmh0bWwiLCJzb2Z0d2FyZV9vbl9iZWhhbGZfb2Zfb3JnIjoiaHR0cHM6Ly9hcGkub3BlbmJhbmtpbmcub3JnLnVrL3NjaW0yL09CVHJ1c3RlZFBheW1lbnRQYXJ0eS8xMjM0NTY3Nzg5Iiwib2JfcmVnaXN0cnlfdG9zIjoiaHR0cHM6Ly9yZWdpc3RyeS5vcGVuYmFua2luZy5vcmcudWsvdG9zLmh0bWwifQ.ELqK-PR8KE3QrGhOuB9idN0vkHmLFRn9NZtl9qAfgVGlEfoF_IeFCx-IjTHISpT9rUpgs5V2VEVQUZ_nf81CQssQTr0NzjesVqqCH4yqRdKB7BCA1WyWbpdt-2HA7_LeUJ4_X8cE_tpwJqFXKSvGtS8v-1kI9Tn5do_JcsQOjxb4fq3y0MA1jAAiA2ALHHGuVY6FHrrthGrBTeIfQGyH8G0x3HHQKBOx3IM0fWNuka5_ztGr3S7Be1piFhlbT0cNDTKXWju8taCoaM91UkH7WEXPs0tjSy2sjBfJPvjHcQ91Q9Ln37rP-SG1XFJGMoqCjGahT-YgoixGt4L_WxH04w`
	ssaValidator := ssa.NewSSAValidator(ssa.PublicKeyLookupFromByteSlice([]byte(PubKeyTest)))
	ssaValue, err := ssaValidator.Validate(ssaJwt)
	if err != nil {
		t.Errorf("should not expect error. Got %s", err.Error())
	}
	if ssaValue.Issuer != "OpenBanking Ltd" {
		t.Errorf("Issuer should be Open Banking Ltd. Got %#v", ssaValue.Issuer)
	}
}
